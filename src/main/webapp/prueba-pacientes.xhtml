<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:comp="http://xmlns.jcp.org/jsf/composite/components">

<h:head>
    <title>Prueba Guardar Paciente - DEBUG MODE</title>
    <h:outputStylesheet library="css" name="common-styles.css"/>
    <h:outputStylesheet library="css" name="sidebar-styles.css"/>
    <style>
        /* Estilos adicionales para modo debug */
        .debug-badge {
            background: linear-gradient(135deg, #ff9800, #fb8c00);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .debug-section {
            background: #fff3cd;
            border-left: 4px solid #ff9800;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .debug-section h4 {
            color: #856404;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .debug-info {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #1976d2;
            margin-bottom: 1rem;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .p-button-warning {
            background: linear-gradient(135deg, #ff9800, #fb8c00) !important;
        }
    </style>
</h:head>

<h:body>
    <div class="dashboard-container">

        <!-- SIDEBAR COMPONENT -->
        <comp:sidebar activePage="pacientes"/>

        <!-- MAIN CONTENT -->
        <div class="main-content">

            <!-- TOP BAR -->
            <div class="top-bar">
                <h1>
                    <i class="pi pi-code"></i>
                    Formulario de Prueba - DEBUG MODE
                </h1>
                <span class="debug-badge">
                    <i class="pi pi-wrench"></i>
                    Modo Desarrollo
                </span>
            </div>

            <!-- CONTENT AREA -->
            <div class="content-area">

                <h:form id="testForm">

                    <!-- ALERTA DE MODO DEBUG -->
                    <div class="debug-section">
                        <h4>
                            <i class="pi pi-info-circle"></i>
                            Modo de Depuraci贸n Activo
                        </h4>
                        <p style="margin: 0;">
                            Este formulario es id茅ntico al de producci贸n pero incluye funciones de debugging.
                            Todos los datos guardados aqu铆 son reales y se almacenar谩n en la base de datos.
                        </p>
                    </div>

                    <!-- MENSAJES -->
                    <p:messages id="msgs" showSummary="true" showDetail="true"/>

                    <!-- CARD PRINCIPAL -->
                    <div class="card">
                        <h2 class="section-title">
                            <i class="pi pi-user-plus"></i>
                            Registro de Nuevo Paciente (Prueba)
                        </h2>

                        <!-- FORMULARIO EN GRID -->
                        <div class="form-grid">

                            <div class="form-field">
                                <h:outputLabel for="dpi" value="DPI (13 d铆gitos):"/>
                                <p:inputText id="dpi"
                                             value="#{pacientesBean.nuevoPaciente.dpi}"
                                             required="true"
                                             requiredMessage="El DPI es obligatorio"
                                             placeholder="Ej: 1234567890123"
                                             styleClass="p-inputtext"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="nombre" value="Nombre:"/>
                                <p:inputText id="nombre"
                                             value="#{pacientesBean.nuevoPaciente.nombre}"
                                             required="true"
                                             requiredMessage="El nombre es obligatorio"
                                             placeholder="Ej: Juan"
                                             styleClass="p-inputtext"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="apellido" value="Apellido:"/>
                                <p:inputText id="apellido"
                                             value="#{pacientesBean.nuevoPaciente.apellido}"
                                             required="true"
                                             requiredMessage="El apellido es obligatorio"
                                             placeholder="Ej: P茅rez"
                                             styleClass="p-inputtext"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="fechaNac" value="Fecha de Nacimiento:"/>
                                <p:calendar id="fechaNac"
                                            value="#{pacientesBean.nuevoPaciente.fechaNacimiento}"
                                            pattern="dd/MM/yyyy"
                                            converter="localDateConverter"
                                            required="true"
                                            requiredMessage="La fecha de nacimiento es obligatoria"
                                            showIcon="true"
                                            showButtonBar="true"
                                            navigator="true"
                                            yearRange="1920:2024"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="tel" value="Tel茅fono:"/>
                                <p:inputText id="tel"
                                             value="#{pacientesBean.nuevoPaciente.contacto}"
                                             required="true"
                                             requiredMessage="El tel茅fono es obligatorio"
                                             placeholder="Ej: 12345678"
                                             styleClass="p-inputtext"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="email" value="Correo Electr贸nico:"/>
                                <p:inputText id="email"
                                             value="#{pacientesBean.nuevoPaciente.correo}"
                                             placeholder="Ej: paciente@email.com"
                                             styleClass="p-inputtext"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="odont" value="Odont贸logo:"/>
                                <p:selectOneMenu id="odont"
                                                 value="#{pacientesBean.odontologoId}"
                                                 required="true"
                                                 requiredMessage="Debe seleccionar un odont贸logo">
                                    <f:selectItem itemLabel="-- Seleccione un odont贸logo --" itemValue="#{null}" noSelectionOption="true"/>
                                    <f:selectItems value="#{pacientesBean.odontologos}"
                                                   var="od"
                                                   itemLabel="#{od.nombreCompleto}"
                                                   itemValue="#{od.id}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="seg" value="Tipo de Seguro:"/>
                                <p:selectOneMenu id="seg"
                                                 value="#{pacientesBean.seguroSeleccionado}"
                                                 required="true"
                                                 requiredMessage="Debe seleccionar un tipo de seguro">
                                    <f:selectItem itemLabel="-- Seleccione tipo de seguro --" itemValue="#{null}" noSelectionOption="true"/>
                                    <f:selectItems value="#{pacientesBean.seguros}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="form-field full-width">
                                <h:outputLabel for="dir" value="Direcci贸n:"/>
                                <p:inputTextarea id="dir"
                                                 value="#{pacientesBean.nuevoPaciente.direccion}"
                                                 rows="2"
                                                 required="true"
                                                 requiredMessage="La direcci贸n es obligatoria"
                                                 placeholder="Ingrese la direcci贸n completa"
                                                 style="width:100%"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="alerg" value="Alergias:"/>
                                <p:inputText id="alerg"
                                             value="#{pacientesBean.nuevoPaciente.alergias}"
                                             placeholder="Ej: Penicilina, Polen"
                                             styleClass="p-inputtext"/>
                            </div>

                            <div class="form-field">
                                <h:outputLabel for="cond" value="Condiciones M茅dicas:"/>
                                <p:inputTextarea id="cond"
                                                 value="#{pacientesBean.nuevoPaciente.condiciones}"
                                                 rows="2"
                                                 placeholder="Ej: Diabetes, Hipertensi贸n"
                                                 style="width:100%"/>
                            </div>

                            <div class="form-field full-width">
                                <h:outputLabel for="obs" value="Observaciones:"/>
                                <p:inputTextarea id="obs"
                                                 value="#{pacientesBean.nuevoPaciente.observaciones}"
                                                 rows="2"
                                                 placeholder="Notas adicionales"
                                                 style="width:100%"/>
                            </div>

                        </div>

                        <!-- SECCIN DE BOTONES DEBUG -->
                        <div class="debug-info">
                            <h4 style="color: #1976d2; margin-bottom: 1rem;">
                                <i class="pi pi-cog"></i>
                                Opciones de Guardado (Testing)
                            </h4>
                            <p style="margin-bottom: 1rem; color: #555;">
                                Prueba ambos m茅todos de guardado para verificar el comportamiento:
                            </p>
                            <div class="btn-group">
                                <p:commandButton value=" Guardar con AJAX"
                                                 action="#{pacientesBean.guardarPaciente}"
                                                 update="msgs tablaPacientes"
                                                 process="@form"
                                                 styleClass="p-button-success"
                                                 icon="pi pi-save">
                                    <p:tooltip for="@this" value="Guarda sin recargar la p谩gina completa"/>
                                </p:commandButton>

                                <p:commandButton value=" Guardar SIN AJAX"
                                                 ajax="false"
                                                 action="#{pacientesBean.guardarPaciente}"
                                                 styleClass="p-button-warning"
                                                 icon="pi pi-save">
                                    <p:tooltip for="@this" value="Recarga la p谩gina completa despu茅s de guardar"/>
                                </p:commandButton>

                                <p:commandButton value=" Limpiar Formulario"
                                                 action="#{pacientesBean.cancelarEdicion}"
                                                 update="testForm"
                                                 process="@this"
                                                 styleClass="p-button-secondary"
                                                 icon="pi pi-times"/>
                            </div>
                        </div>

                    </div>

                    <!-- TABLA DE PACIENTES -->
                    <div class="card">
                        <h2 class="section-title">
                            <i class="pi pi-list"></i>
                            Pacientes Registrados (Vista de Prueba)
                        </h2>

                        <p:dataTable id="tablaPacientes"
                                     value="#{pacientesBean.pacientes}"
                                     var="p"
                                     rows="5"
                                     paginator="true"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords}"
                                     emptyMessage="No hay pacientes registrados">

                            <p:column headerText="ID" width="60" style="text-align:center">
                                <h:outputText value="#{p.id}"/>
                            </p:column>

                            <p:column headerText="DPI">
                                <h:outputText value="#{p.dpi}"/>
                            </p:column>

                            <p:column headerText="Nombre Completo">
                                <h:outputText value="#{p.nombreCompleto}"/>
                            </p:column>

                            <p:column headerText="Tel茅fono">
                                <h:outputText value="#{p.contacto}"/>
                            </p:column>

                            <p:column headerText="Correo">
                                <h:outputText value="#{p.correo}"/>
                            </p:column>

                            <p:column headerText="Odont贸logo">
                                <h:outputText value="#{p.odontologo != null ? p.odontologo.nombreCompleto : 'Sin asignar'}"/>
                            </p:column>

                            <p:column headerText="Seguro">
                                <h:outputText value="#{p.seguro}"/>
                            </p:column>

                            <p:column headerText="Debug" width="100" style="text-align:center">
                                <p:tag value="ID: #{p.id}" severity="info" style="font-size: 0.8rem;"/>
                            </p:column>

                        </p:dataTable>
                    </div>

                    <!-- INFORMACIN DE DEBUG -->
                    <div class="debug-section" style="margin-top: 2rem;">
                        <h4>
                            <i class="pi pi-info-circle"></i>
                            Informaci贸n de Debug
                        </h4>
                        <ul style="margin: 0.5rem 0 0 1.5rem; color: #856404;">
                            <li>Bean utilizado: <code>#{pacientesBean.class.simpleName}</code></li>
                            <li>Total de pacientes en lista: <strong>#{pacientesBean.pacientes.size()}</strong></li>
                            <li>Estado del nuevo paciente: #{pacientesBean.nuevoPaciente.id == null ? 'NUEVO' : 'EDITANDO'}</li>
                            <li>Odont贸logos disponibles: <strong>#{pacientesBean.odontologos.size()}</strong></li>
                        </ul>
                    </div>

                </h:form>

            </div>
        </div>
    </div>

</h:body>
</html>