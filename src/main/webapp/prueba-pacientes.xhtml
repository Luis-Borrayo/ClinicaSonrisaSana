<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/template.xhtml">

    <ui:define name="title">Gestión de Pacientes</ui:define>

    <ui:define name="content">

        <h:form id="mainForm">

            <!-- TARJETA SUPERIOR -->
            <p:card style="margin-bottom:20px">
                <h2 style="margin:0; font-size:24px; color:#004C97;">
                    Gestión de Pacientes
                </h2>
                <p style="margin-top:6px; color:#666;">
                    Registro, edición y consulta de pacientes.
                </p>
            </p:card>

            <!-- MENSAJES -->
            <p:messages id="messages"
                        autoUpdate="true"
                        closable="true"
                        showSummary="true"
                        showDetail="true"
                        style="margin-bottom:15px"/>

            <!-- FORMULARIO -->
            <p:panel header="Información del Paciente" style="margin-bottom:20px">

                <p:panelGrid columns="2" columnClasses="label,value">

                    <h:outputLabel for="dpi" value="DPI:"/>
                    <p:inputText id="dpi"
                                 value="#{pacientesBean.nuevoPaciente.dpi}"
                                 required="true"/>

                    <h:outputLabel for="nombre" value="Nombre:"/>
                    <p:inputText id="nombre"
                                 value="#{pacientesBean.nuevoPaciente.nombre}"
                                 required="true"/>

                    <h:outputLabel for="apellido" value="Apellido:"/>
                    <p:inputText id="apellido"
                                 value="#{pacientesBean.nuevoPaciente.apellido}"
                                 required="true"/>

                    <h:outputLabel for="fecha" value="Fecha nacimiento:"/>
                    <p:datePicker id="fecha"
                                  value="#{pacientesBean.nuevoPaciente.fechaNacimiento}"
                                  pattern="dd/MM/yyyy"
                                  required="true"/>

                    <h:outputLabel for="contacto" value="Teléfono:"/>
                    <p:inputText id="contacto"
                                 value="#{pacientesBean.nuevoPaciente.contacto}"
                                 required="true"/>

                    <h:outputLabel for="correo" value="Correo:"/>
                    <p:inputText id="correo"
                                 value="#{pacientesBean.nuevoPaciente.correo}">
                        <f:validateRegex pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"/>
                    </p:inputText>

                    <h:outputLabel for="odontologo" value="Odontólogo:"/>
                    <p:selectOneMenu id="odontologo"
                                     value="#{pacientesBean.odontologoId}"
                                     required="true">
                        <f:selectItem itemLabel="-- Seleccione --" itemValue="#{null}" noSelectionOption="true"/>
                        <f:selectItems value="#{pacientesBean.odontologos}"
                                       var="od" itemLabel="#{od.nombreCompleto}"
                                       itemValue="#{od.id}"/>
                    </p:selectOneMenu>

                    <h:outputLabel for="seguro" value="Seguro:"/>
                    <p:selectOneMenu id="seguro"
                                     value="#{pacientesBean.seguroSeleccionado}"
                                     required="true">
                        <f:selectItem itemLabel="-- Seleccione --" itemValue="#{null}" noSelectionOption="true"/>
                        <f:selectItems value="#{pacientesBean.seguros}"/>
                    </p:selectOneMenu>

                    <h:outputLabel for="direccion" value="Dirección:"/>
                    <p:inputTextarea id="direccion"
                                     value="#{pacientesBean.nuevoPaciente.direccion}"
                                     rows="2"
                                     style="width:100%"
                                     required="true"/>

                    <h:outputLabel for="alergias" value="Alergias:"/>
                    <p:inputText id="alergias"
                                 value="#{pacientesBean.nuevoPaciente.alergias}"/>

                </p:panelGrid>

                <p:separator/>

                <p:commandButton value="Guardar"
                                 action="#{pacientesBean.guardarPaciente}"
                                 update="messages tabla"
                                 icon="pi pi-save"
                                 styleClass="p-button-rounded p-button-success"/>

            </p:panel>

            <!-- TABLA -->
            <p:panel header="Pacientes Registrados">
                <p:dataTable id="tabla"
                             value="#{pacientesBean.pacientes}"
                             var="p"
                             paginator="true"
                             rows="8"
                             style="width:100%">

                    <p:column headerText="ID" width="60">
                        <h:outputText value="#{p.id}"/>
                    </p:column>

                    <p:column headerText="Nombre completo">
                        <h:outputText value="#{p.nombre} #{p.apellido}"/>
                    </p:column>

                    <p:column headerText="DPI">
                        <h:outputText value="#{p.dpi}"/>
                    </p:column>

                    <p:column headerText="Odontólogo">
                        <h:outputText value="#{p.odontologo != null ? p.odontologo.nombreCompleto : ''}"/>
                    </p:column>

                    <p:column headerText="Dirección">
                        <h:outputText value="#{p.direccion}"/>
                    </p:column>

                </p:dataTable>
            </p:panel>

        </h:form>

    </ui:define>

</ui:composition>

</html>

