<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>GestiÃ³n de Pacientes</title>
</h:head>

<h:body>

    <h:form id="mainForm">

        <!-- ğŸ”¹ Mostrar errores / validaciones -->
        <h:messages id="hMessages" globalOnly="false" layout="list" redisplay="true"/>
        <p:messages id="messages" autoUpdate="true"/>

        <h2>Registro de Pacientes</h2>

        <p:panelGrid columns="2" columnClasses="label,value" style="width: 50%">

            <h:outputLabel value="DPI:"/>
            <p:inputText value="#{pacientesBean.nuevoPaciente.dpi}"
                         required="true"
                         requiredMessage="El DPI es obligatorio"/>

            <h:outputLabel value="Nombre:"/>
            <p:inputText value="#{pacientesBean.nuevoPaciente.nombre}"
                         required="true"
                         requiredMessage="El nombre es obligatorio"/>

            <h:outputLabel value="Fecha Nacimiento:"/>

            <!-- ğŸ”¹ Calendar corregido -->
            <p:calendar id="fechaNacimiento"
                        value="#{pacientesBean.nuevoPaciente.fechaNacimiento}"
                        pattern="dd/MM/yyyy"
                        converter="localDateConverter"
                        required="true"
                        requiredMessage="Debe ingresar una fecha"
                        converterMessage="Fecha invÃ¡lida, use dd/MM/yyyy"
                        showButtonBar="true"
                        navigator="true"
                        yearRange="1920:2024"/>

        </p:panelGrid>

        <br/>

        <!-- ğŸ”¹ BotÃ³n guardar corregido -->
        <p:commandButton value="#{pacientesBean.nuevoPaciente.id == null ? 'Guardar Paciente' : 'Actualizar Paciente'}"
                         action="#{pacientesBean.guardarPaciente}"
                         update=":mainForm:messages :mainForm:hMessages :mainForm:pacientesTable"
                         process="@form"
                         styleClass="p-button-success"
                         icon="pi pi-save"
                         ajax="true"/>

        <br/><br/>

        <!-- ğŸ”¹ Tabla de pacientes -->
        <p:dataTable id="pacientesTable"
                     value="#{pacientesBean.listaPacientes}"
                     var="pac"
                     style="width: 80%">

            <p:column headerText="ID">
                <h:outputText value="#{pac.id}"/>
            </p:column>

            <p:column headerText="DPI">
                <h:outputText value="#{pac.dpi}"/>
            </p:column>

            <p:column headerText="Nombre">
                <h:outputText value="#{pac.nombre}"/>
            </p:column>

            <p:column headerText="Fecha Nacimiento">
                <h:outputText value="#{pac.fechaNacimiento}"/>
            </p:column>

            <p:column headerText="Acciones">
                <p:commandButton value="Editar"
                                 action="#{pacientesBean.editarPaciente(pac)}"
                                 update=":mainForm"/>
            </p:column>

        </p:dataTable>

        <br/>

        <!-- ğŸ”¹ BOTONES DE DEBUG -->
        <p:commandButton value="DEBUG - Submit sin AJAX"
                         action="#{pacientesBean.guardarPaciente}"
                         ajax="false"
                         styleClass="p-button-warning"/>

        <p:commandButton value="DEBUG - Immediate (omite validaciones)"
                         action="#{pacientesBean.guardarPaciente}"
                         process="@this"
                         immediate="true"
                         update=":mainForm:messages :mainForm:hMessages"
                         styleClass="p-button-danger"/>

    </h:form>

</h:body>
</html>
