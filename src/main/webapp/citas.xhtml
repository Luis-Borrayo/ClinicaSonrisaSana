<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gesti贸n de Citas - Cl铆nica Sonrisa Sana</title>
    <meta charset="UTF-8"/>
    <h:outputStylesheet>
        * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        }

        body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f5 100%);
        min-height: 100vh;
        }

        .dashboard-container {
        display: flex;
        min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
        width: 260px;
        background: linear-gradient(180deg, #1976d2 0%, #1565c0 100%);
        color: white;
        padding: 0;
        box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        }

        .sidebar-header {
        padding: 2rem 1.5rem;
        background: rgba(0,0,0,0.1);
        border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h2 {
        font-size: 1.3rem;
        margin-bottom: 0.3rem;
        font-weight: 600;
        }

        .sidebar-header p {
        font-size: 0.9rem;
        opacity: 0.9;
        }

        .sidebar-menu {
        flex: 1;
        padding: 1rem 0;
        overflow-y: auto;
        }

        .menu-item {
        padding: 1rem 1.5rem;
        cursor: pointer;
        transition: all 0.3s;
        border-left: 4px solid transparent;
        display: flex;
        align-items: center;
        gap: 12px;
        color: white;
        text-decoration: none;
        }

        .menu-item:hover {
        background: rgba(255,255,255,0.1);
        border-left-color: #64b5f6;
        }

        .menu-item.active {
        background: rgba(255,255,255,0.15);
        border-left-color: white;
        }

        .menu-item i {
        font-size: 1.2rem;
        }

        .sidebar-footer {
        padding: 1.5rem;
        border-top: 2px solid rgba(255,255,255,0.1);
        }

        /* Main Content */
        .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-left: 260px;
        }

        /* Top Bar */
        .top-bar {
        background: white;
        padding: 1.5rem 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
        }

        .top-bar h1 {
        color: #1976d2;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        gap: 12px;
        }

        /* Content Area */
        .content-area {
        padding: 2rem;
        flex: 1;
        }

        .card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
        }

        .section-title {
        color: #1976d2;
        border-bottom: 3px solid #1976d2;
        padding-bottom: 10px;
        margin-bottom: 20px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
        }

        .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1rem;
        }

        .form-field {
        display: flex;
        flex-direction: column;
        }

        .form-field label {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
        }

        .form-actions {
        text-align: center;
        margin-top: 1.5rem;
        }

        .full-width {
        grid-column: 1 / -1;
        }

        /* Buttons */
        .p-button-success {
        background: linear-gradient(135deg, #1976d2, #2196f3) !important;
        border: none !important;
        padding: 0.8rem 2rem !important;
        border-radius: 8px !important;
        font-weight: 600 !important;
        }

        .p-button-success:hover {
        background: linear-gradient(135deg, #1565c0, #1976d2) !important;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4) !important;
        }

        .p-button-danger {
        background: linear-gradient(135deg, #f44336, #e53935) !important;
        border: none !important;
        }

        .p-button-danger:hover {
        background: linear-gradient(135deg, #e53935, #d32f2f) !important;
        }

        .logout-btn {
        background: linear-gradient(135deg, #f44336, #e53935) !important;
        width: 100%;
        border: none !important;
        }

        /* Table Styles */
        .p-datatable .p-datatable-thead > tr > th {
        background: linear-gradient(135deg, #1976d2, #2196f3) !important;
        color: white !important;
        font-weight: 600 !important;
        padding: 1rem !important;
        }

        .p-datatable .p-datatable-tbody > tr {
        transition: all 0.3s;
        }

        .p-datatable .p-datatable-tbody > tr:hover {
        background: #e3f2fd !important;
        }

        /* Messages */
        .ui-messages {
        margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
        .sidebar {
        width: 0;
        overflow: hidden;
        }

        .main-content {
        margin-left: 0;
        }

        .form-grid {
        grid-template-columns: 1fr;
        }
        }
    </h:outputStylesheet>
</h:head>

<h:body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Ψ Sonrisa Sana</h2>
                <p>Sistema de Gesti贸n</p>
            </div>

            <div class="sidebar-menu">
                <h:link outcome="principalrecep.xhtml" styleClass="menu-item">
                    <i class="pi pi-home"></i>
                    <span>Inicio</span>
                </h:link>
                <h:link outcome="citas.xhtml" styleClass="menu-item">
                    <i class="pi pi-calendar"></i>
                    <span>Gesti贸n de Citas</span>
                </h:link>
                <h:link outcome="pacientes.xhtml" class="menu-item">
                    <i class="pi pi-users"></i>
                    <span>Pacientes</span>
                </h:link>
                <div class="menu-item">
                    <i class="pi pi-user"></i>
                    <span>Empleados</span>
                </div>
                <div class="menu-item">
                    <i class="pi pi-heart"></i>
                    <span>Tratamientos</span>
                </div>
                <div class="menu-item">
                    <i class="pi pi-shield"></i>
                    <span>Seguros M茅dicos</span>
                </div>
                <div class="menu-item">
                    <i class="pi pi-file"></i>
                    <span>Facturaci贸n</span>
                </div>
                <div class="menu-item">
                    <i class="pi pi-upload"></i>
                    <span>Subir archivos S3</span>
                </div>
            </div>

            <div class="sidebar-footer">
                <h:form>
                    <p:commandButton value="Cerrar Sesi贸n"
                                     icon="pi pi-sign-out"
                                     action="#{loginBean.logout}"
                                     styleClass="logout-btn"/>
                </h:form>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <h1>
                    <i class="pi pi-calendar"></i>
                    Gesti贸n de Citas
                </h1>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <p:messages id="messages" autoUpdate="true" />

                <!-- Formulario para nueva cita -->
                <div class="card">
                    <h3 class="section-title">
                        <i class="pi pi-plus-circle"></i>
                        Nueva Cita
                    </h3>
                    <h:form id="citaForm">
                        <div class="form-grid">
                            <!-- Paciente -->
                            <div class="form-field">
                                <p:outputLabel value="Paciente:" for="paciente" />
                                <p:selectOneMenu id="paciente" value="#{citasBean.pacienteId}" required="true"
                                                 requiredMessage="Seleccione un paciente" style="width: 100%">
                                    <f:selectItem itemLabel="Seleccione paciente" itemValue="" />
                                    <f:selectItems value="#{citasBean.pacientes}" var="paciente"
                                                   itemLabel="#{paciente.nombre}" itemValue="#{paciente.id}" />
                                </p:selectOneMenu>
                                <p:message for="paciente" display="icon" />
                            </div>

                            <!-- Odont贸logo -->
                            <div class="form-field">
                                <p:outputLabel value="Odont贸logo:" for="odontologo" />
                                <p:selectOneMenu id="odontologo" value="#{citasBean.odontologoId}" required="true"
                                                 requiredMessage="Seleccione un odont贸logo" style="width: 100%">
                                    <f:selectItem itemLabel="Seleccione odont贸logo" itemValue="" />
                                    <f:selectItems value="#{citasBean.odontologos}" var="odontologo"
                                                   itemLabel="#{odontologo.usuario.nombres} #{odontologo.usuario.apellidos}"
                                                   itemValue="#{odontologo.id}" />
                                </p:selectOneMenu>
                                <p:message for="odontologo" display="icon" />
                            </div>

                            <!-- Tratamiento -->
                            <div class="form-field">
                                <p:outputLabel value="Tratamiento:" for="tratamiento" />
                                <p:selectOneMenu id="tratamiento" value="#{citasBean.tratamientoId}" style="width: 100%">
                                    <f:selectItem itemLabel="Seleccione tratamiento" itemValue="" />
                                    <f:selectItems value="#{citasBean.tratamientos}" var="tratamiento"
                                                   itemLabel="#{tratamiento.nombre}" itemValue="#{tratamiento.id}" />
                                </p:selectOneMenu>
                            </div>

                            <!-- Fecha y Hora -->
                            <div class="form-field">
                                <p:outputLabel value="Fecha y Hora:" for="fecha" />
                                <p:calendar id="fecha" value="#{citasBean.nuevaCita.fechaCita}"
                                            pattern="dd/MM/yyyy HH:mm" required="true"
                                            requiredMessage="Seleccione fecha y hora" style="width: 100%"
                                            showTime="true" timeOnly="false" />
                                <p:message for="fecha" display="icon" />
                            </div>

                            <!-- Estado -->
                            <div class="form-field">
                                <p:outputLabel value="Estado:" for="estado" />
                                <p:selectOneMenu id="estado" value="#{citasBean.nuevaCita.estado}" required="true"
                                                 requiredMessage="Seleccione estado" style="width: 100%">
                                    <f:selectItem itemLabel="Seleccione estado" itemValue="" />
                                    <f:selectItem itemLabel="Programada" itemValue="PROGRAMADA" />
                                    <f:selectItem itemLabel="Completada" itemValue="COMPLETADA" />
                                    <f:selectItem itemLabel="Cancelada" itemValue="CANCELADA" />
                                </p:selectOneMenu>
                                <p:message for="estado" display="icon" />
                            </div>

                            <!-- Observaciones -->
                            <div class="form-field full-width">
                                <p:outputLabel value="Observaciones:" for="observaciones" />
                                <p:inputTextarea id="observaciones" value="#{citasBean.nuevaCita.observaciones}"
                                                 rows="3" style="width: 100%" placeholder="Ingrese observaciones adicionales..." />
                            </div>
                        </div>

                        <div class="form-actions">
                            <p:commandButton value="Guardar Cita" action="#{citasBean.guardarCita}"
                                             update="@form :citasTable :messages" process="@form"
                                             styleClass="p-button-success" icon="pi pi-save"/>
                        </div>
                    </h:form>
                </div>

                <!-- Lista de citas -->
                <div class="card">
                    <h3 class="section-title">
                        <i class="pi pi-list"></i>
                        Lista de Citas
                    </h3>
                    <p:dataTable id="citasTable" value="#{citasBean.citas}" var="cita"
                                 emptyMessage="No hay citas registradas" style="width: 100%"
                                 paginator="true" rows="10"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="5,10,15"
                                 styleClass="p-datatable-striped p-datatable-gridlines">

                        <p:column headerText="ID" width="80" style="text-align: center;">
                            <h:outputText value="#{cita.id}" />
                        </p:column>

                        <p:column headerText="Paciente" sortBy="#{cita.paciente.nombre}">
                            <h:outputText value="#{cita.paciente.nombre}" />
                        </p:column>

                        <p:column headerText="Odont贸logo" sortBy="#{cita.odontologo.usuario.nombres}">
                            <h:outputText value="#{cita.odontologo.usuario.nombres} #{cita.odontologo.usuario.apellidos}" />
                        </p:column>

                        <p:column headerText="Tratamiento" sortBy="#{cita.tratamiento.nombre}">
                            <h:outputText value="#{cita.tratamiento != null ? cita.tratamiento.nombre : 'N/A'}" />
                        </p:column>

                        <p:column headerText="Fecha" width="180" sortBy="#{cita.fechaCita}">
                            <h:outputText value="#{cita.fechaCita}">
                                <f:converter converterId="localDateTimeConverter" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Estado" width="120" sortBy="#{cita.estado}">
                            <p:tag value="#{cita.estado}"
                                   severity="#{cita.estado == 'PROGRAMADA' ? 'warning' : cita.estado == 'COMPLETADA' ? 'success' : 'danger'}" />
                        </p:column>

                        <p:column headerText="Acciones" width="120" style="text-align: center;">
                            <p:commandButton icon="pi pi-trash"
                                             action="#{citasBean.eliminarCita}"
                                             update="citasTable :messages"
                                             process="@this"
                                             styleClass="p-button-danger p-button-outlined p-button-sm"
                                             title="Eliminar cita">
                                <f:setPropertyActionListener target="#{citasBean.citaSeleccionada}" value="#{cita}" />
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
        </div>
    </div>
</h:body>
</html>