<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Gesti√≥n de Citas - Cl√≠nica Sonrisa Sana</title>
    <style>
        .layout-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 20px 0;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            background: #ffffff;
        }

        .card {
            background: #ffffff;
            padding: 2rem;
            box-shadow: 0 2px 1px -1px rgba(0,0,0,.2), 0 1px 1px 0 rgba(0,0,0,.14), 0 1px 3px 0 rgba(0,0,0,.12);
            border-radius: 6px;
            margin-bottom: 2rem;
        }

        .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .clinic-header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }

        .clinic-logo {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            margin-bottom: 20px;
            border-radius: 0 0 8px 8px;
        }
    </style>
</h:head>

<h:body>
    <div class="layout-container">
        <!-- MEN√ö LATERAL -->
        <div class="sidebar">
            <div class="clinic-logo">
                <h3 style="margin: 0; color: white;">üè• Cl√≠nica Sonrisa Sana</h3>
                <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">Gesti√≥n Dental</p>
            </div>

            <!-- FORM AGREGADO AQU√ç PARA EL MEN√ö -->
            <h:form id="menuForm">
                <p:tabMenu activeIndex="2" style="width:100%" orientation="left">
                    <p:menuitem value="Inicio" outcome="/index?faces-redirect=true" icon="pi pi-fw pi-home">
                        <f:param name="i" value="0"/>
                    </p:menuitem>
                    <p:menuitem value="Subir Archivos S3" outcome="/upload?faces-redirect=true" icon="pi pi-fw pi-cloud-upload">
                        <f:param name="i" value="1"/>
                    </p:menuitem>
                    <p:menuitem value="Gesti√≥n de Citas" outcome="/citas?faces-redirect=true" icon="pi pi-fw pi-calendar">
                        <f:param name="i" value="2"/>
                    </p:menuitem>
                    <p:menuitem value="Pacientes" outcome="/pacientes?faces-redirect=true" icon="pi pi-fw pi-users" disabled="true">
                        <f:param name="i" value="3"/>
                    </p:menuitem>
                    <p:menuitem value="Configuraci√≥n" outcome="/config?faces-redirect=true" icon="pi pi-fw pi-cog" disabled="true">
                        <f:param name="i" value="4"/>
                    </p:menuitem>
                </p:tabMenu>
            </h:form>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <h1 class="clinic-header">üìÖ Gesti√≥n de Citas</h1>

            <p:messages id="messages" autoUpdate="true" />

            <!-- Formulario para nueva cita -->
            <div class="card">
                <h3 class="section-title">‚ûï Nueva Cita</h3>
                <h:form id="citaForm">
                    <p:panelGrid columns="2" style="width: 100%;">
                        <p:outputLabel value="Paciente:" for="paciente" />
                        <p:selectOneMenu id="paciente" value="#{citasBean.pacienteId}" required="true"
                                         requiredMessage="Seleccione un paciente" style="width: 100%">
                            <f:selectItem itemLabel="Seleccione paciente" itemValue="" />
                            <f:selectItems value="#{citasBean.pacientes}" var="paciente"
                                           itemLabel="#{paciente.nombre}" itemValue="#{paciente.id}" />
                        </p:selectOneMenu>

                        <p:outputLabel value="Odont√≥logo:" for="odontologo" />
                        <p:selectOneMenu id="odontologo" value="#{citasBean.odontologoId}" required="true"
                                         requiredMessage="Seleccione un odont√≥logo" style="width: 100%">
                            <f:selectItem itemLabel="Seleccione odont√≥logo" itemValue="" />
                            <f:selectItems value="#{citasBean.odontologos}" var="odontologo"
                                           itemLabel="#{odontologo.nombre}" itemValue="#{odontologo.id}" />
                        </p:selectOneMenu>

                        <p:outputLabel value="Tratamiento:" for="tratamiento" />
                        <p:selectOneMenu id="tratamiento" value="#{citasBean.tratamientoId}" style="width: 100%">
                            <f:selectItem itemLabel="Seleccione tratamiento" itemValue="" />
                            <f:selectItems value="#{citasBean.tratamientos}" var="tratamiento"
                                           itemLabel="#{tratamiento.nombre}" itemValue="#{tratamiento.id}" />
                        </p:selectOneMenu>

                        <p:outputLabel value="Fecha y Hora:" for="fecha" />
                        <p:calendar id="fecha" value="#{citasBean.nuevaCita.fechaCita}"
                                    pattern="dd/MM/yyyy HH:mm" required="true"
                                    requiredMessage="Seleccione fecha y hora" style="width: 100%"
                                    showTime="true" timeOnly="false" />

                        <p:outputLabel value="Estado:" for="estado" />
                        <p:selectOneMenu id="estado" value="#{citasBean.nuevaCita.estado}" required="true"
                                         requiredMessage="Seleccione estado" style="width: 100%">
                            <f:selectItem itemLabel="Seleccione estado" itemValue="" />
                            <f:selectItem itemLabel="Programada" itemValue="PROGRAMADA" />
                            <f:selectItem itemLabel="Completada" itemValue="COMPLETADA" />
                            <f:selectItem itemLabel="Cancelada" itemValue="CANCELADA" />
                        </p:selectOneMenu>

                        <p:outputLabel value="Observaciones:" for="observaciones" />
                        <p:inputTextarea id="observaciones" value="#{citasBean.nuevaCita.observaciones}"
                                         rows="3" style="width: 100%" />
                    </p:panelGrid>

                    <div style="margin-top: 20px; text-align: center;">
                        <p:commandButton value="üíæ Guardar Cita" action="#{citasBean.guardarCita}"
                                         update="@form citasTable :messages" process="@form"
                                         styleClass="p-button-success" icon="pi pi-save"/>
                    </div>
                </h:form>
            </div>

            <!-- Lista de citas -->
            <div class="card">
                <h3 class="section-title">üìã Lista de Citas</h3>
                <p:dataTable id="citasTable" value="#{citasBean.citas}" var="cita"
                             emptyMessage="No hay citas registradas" style="width: 100%"
                             paginator="true" rows="10" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15">
                    <p:column headerText="ID" width="80" style="text-align: center;">
                        <h:outputText value="#{cita.id}" />
                    </p:column>

                    <p:column headerText="Paciente">
                        <h:outputText value="#{cita.paciente.nombre}" />
                    </p:column>

                    <p:column headerText="Odont√≥logo">
                        <h:outputText value="#{cita.odontologo.nombre}" />
                    </p:column>

                    <p:column headerText="Tratamiento">
                        <h:outputText value="#{cita.tratamiento != null ? cita.tratamiento.nombre : 'N/A'}" />
                    </p:column>

                    <p:column headerText="Fecha" width="180">
                        <h:outputText value="#{cita.fechaCita}">
                            <f:converter converterId="localDateTimeConverter" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Estado" width="120">
                        <p:tag value="#{cita.estado}"
                               severity="#{cita.estado == 'PROGRAMADA' ? 'warning' : cita.estado == 'COMPLETADA' ? 'success' : 'danger'}" />
                    </p:column>

                    <p:column headerText="Acciones" width="100" style="text-align: center;">
                        <p:commandButton icon="pi pi-trash" action="#{citasBean.eliminarCita}"
                                         update="citasTable :messages" process="@this"
                                         styleClass="p-button-danger p-button-outlined">
                            <f:setPropertyActionListener target="#{citasBean.citaSeleccionada}" value="#{cita}" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </div>
        </div>
    </div>
</h:body>
</html>